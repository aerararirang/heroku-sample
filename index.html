<!DOCTYPE html>
<html>

<head>
  <title>ChatTalk</title>
  <h1>Socket.IO Messenger</h1>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    h1 {
      text-align: center;
    }

    body {
      font: 13px Helvetica, Arial;
      background: linear-gradient(rgb(91, 143, 248), #FF66FF);
      border-radius: 6px;
      height: 1000px;
    }

    form, #nick {
      background: #fff;
      padding: 3px;
      position: fixed;
      bottom: 0;
      width: 100%;
      border-color: #000;
      border-top-style: solid;
      border-top-width: 1px;
    }

    form input, #nickname {
      border-style: solid;
      border-width: 1px;
      padding: 10px;
      width: 85%;
      margin-right: .5%;
    }

    form button, #logIn {
      width: 9%;
      background: rgb(130, 224, 255);
      border: none;
      padding: 10px;
      margin-left: 2%;
    }

    #messages {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }

    #messages li {
      padding: 5px 10px;
    }

    #chat {
      display: none;
    }
  </style>
  <script src="../../socket.io/socket.io.js"></script>
  <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
  <script src=”https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"> </script> <script src=”http://code.jquery.com/jquery-latest.min.js">
  </script> </head> <body>
    <center>
            <div id="nick">
                <p>Enter nickname:</p>
                <div>
                    <input type="text" id="nickname" placeholder="Nickname">
                </div>
                <button id="logIn">Login</button>
            </div>
    </center>
  <div id = "chat">
    <ul id = "messages" class = "messages"></ul>
    <i id = "typing"></i>
    <form action="/" method="POST" class="chatForm">
      <input id="message" placeholder="Say something" /><button>Send</button>
    </form>
  </div>
  <script>
    $(function () {
      var socket = io.connect('http://localhost:3000');

      var nickname = $('#nickname'); //user input nickname
      $('#logIn').click(function () {
        nickname = nickname.val();
        $('center').hide();
        $("#chat").show();
        socket.emit('username', nickname);

        $('form').submit(function (e) {
          e.preventDefault(); // prevents page reloading
          socket.emit('chat_message', $('#message').val());
          $('#message').val('');
          return false;
        });

        // append the chat text message
        socket.on('chat_message', function (msg) {
          $('#messages').append($('<li>').html(msg));
        });

        // append text if someone is online
        socket.on('is_online', function (username) {
          $('#messages').append($('<li>').html(username));
        });

        //isTyping event
        message.addEventListener("keypress", () => {
          socket.emit("typing", { user: nickname, message: "is typing..." });
        });

        socket.on("notifyTyping", data => {
          typing.innerText = data.user + "  " + data.message;
          console.log(data.user + data.message);
        });

        //stop typing
        message.addEventListener("keyup", () => {
          socket.emit("stopTyping", "");
        });

        socket.on("notifyStopTyping", () => {
          typing.innerText = "";
        });
      });
    });
  </script>
  </body>

</html>